<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Flappy Photo Game</title>
<style>
body{
margin:0;
overflow:hidden;
background:black;
}
canvas{
display:block;
}
</style>
</head>

<body>

<canvas id="gameCanvas"></canvas>
<audio id="bgm" src="music.mp3" loop></audio>

<script>

let canvas=document.getElementById("gameCanvas");
let ctx=canvas.getContext("2d");

canvas.width=window.innerWidth;
canvas.height=window.innerHeight;

let birdImg=new Image();
birdImg.src="img1.png";

let pipeImg=new Image();
pipeImg.src="image2.png";

let bgImg=new Image();
bgImg.src="bg.png";

let bgm=document.getElementById("bgm");

let x=80;
let y;
let velocity=0;
let gravity=0.6;
let lift=-10;

let pipes=[];
let score=0;
let gameOver=false;

let gap=320;          // BIG GAP
let pipeWidth=70;
let pipeSpeed=2.5;
let frame=0;

function resetGame(){
y=canvas.height/2;
velocity=0;
pipes=[];
score=0;
gameOver=false;
frame=0;
}

document.onclick=()=>{
if(gameOver){
resetGame();
update();
}else{
velocity=lift;
bgm.play();
}
};

function drawBird(){
ctx.save();
let angle = velocity * 0.05;
ctx.translate(x+30,y+30);
ctx.rotate(angle);
ctx.drawImage(birdImg,-30,-30,60,60);
ctx.restore();
}

function drawPipe(pipe){

if(pipeImg.complete){

let pattern = ctx.createPattern(pipeImg,"repeat-y");
ctx.fillStyle = pattern;

// TOP PIPE
ctx.fillRect(pipe.x,0,pipeWidth,pipe.top);

// BOTTOM PIPE
ctx.fillRect(pipe.x,pipe.bottom,pipeWidth,canvas.height);

}

}

function update(){

ctx.drawImage(bgImg,0,0,canvas.width,canvas.height);

velocity+=gravity;
y+=velocity;

drawBird();

frame++;

if(frame % 110 == 0){

let top = Math.random()*(canvas.height-gap-200)+100;

pipes.push({
x:canvas.width,
top:top,
bottom:top+gap,
scored:false
});

}

for(let i=0;i<pipes.length;i++){

pipes[i].x -= pipeSpeed;

drawPipe(pipes[i]);

// COLLISION
if(
x+50 > pipes[i].x &&
x < pipes[i].x + pipeWidth &&
(
y < pipes[i].top ||
y+50 > pipes[i].bottom
)
){
gameOver=true;
}

// SCORE
if(!pipes[i].scored && pipes[i].x + pipeWidth < x){
score++;
pipes[i].scored=true;
}

}

ctx.fillStyle="white";
ctx.font="28px Arial";
ctx.fillText("Score: "+score,20,50);

if(y+50 > canvas.height || y < 0){
gameOver=true;
}

if(!gameOver){
requestAnimationFrame(update);
}else{
ctx.fillStyle="white";
ctx.font="40px Arial";
ctx.fillText("Game Over",canvas.width/2-110,canvas.height/2);
ctx.font="22px Arial";
ctx.fillText("Tap to Restart",canvas.width/2-80,canvas.height/2+40);
}
}

resetGame();
update();

</script>

</body>
</html>
